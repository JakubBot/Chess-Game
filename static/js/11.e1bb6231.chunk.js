(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[11],{116:function(e,t,n){"use strict";n.r(t);var a=n(28),o=n(1),r=n.n(o),i=n(20),c=n(68),u=n(5),s=n(86),l=n(19),d=n.n(l),p=n(87),b=n.n(p),f=n(74),m=n(6),v=n(73),S=n(91),O=n(16),g=n(71),k=n(70),j=n(69),h=["boardType","piece","user","mode","updateMoves","updateStatusText","changeSite","updateLocalStorage"],w=window.jQuery,_=null,x=null,T=function(e){var t=e.boardType,n=e.piece,i=e.user,c=(e.mode,e.updateMoves),l=e.updateStatusText,d=e.changeSite,p=e.updateLocalStorage,m=Object(s.a)(e,h),T=Object(o.useState)(new b.a),y=Object(a.a)(T,1)[0],E=Object(o.useState)({token:m.match.params.token}),L=Object(a.a)(E,2),q=L[0],I=L[1],P=Object(o.useRef)(null),R=Object(o.useRef)(null),N=Object(o.useState)(!1),M=Object(a.a)(N,2),C=M[0],G=M[1];return Object(o.useEffect)((function(){var e,t,n=null,a=Object(g.b)(q.token,q);return q.isGameActive&&1===a&&(n=setInterval((function(){Object(g.c)(q,y)}),1e3)),((null===(e=q.timeLeft)||void 0===e?void 0:e.whiteTime)<=0||(null===(t=q.timeLeft)||void 0===t?void 0:t.blackTime)<=0)&&(clearInterval(n),G(!0)),function(){return clearInterval(n)}}),[q.isGameActive,q.timeLeft]),Object(o.useEffect)((function(){var e,o;return e=q.token,o=function(e,a){!function(e,a){var o=Object(g.b)(q.token,a);y.load(a.fen||"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"),x?Object(k.b)(o,y.turn())&&x.position(y.fen()):(x=function(e,a){var o=Object(g.b)(q.token,a),r={pieceTheme:"".concat("/Chess-Game","/img/chesspieces/").concat(n,"/{piece}.png"),draggable:!0,position:"start",onDragStart:function(e,t){return Object(k.c)(y,e),w('img[data-piece="'.concat(t,'"]')).addClass("z-index"),!y.game_over()&&Object(k.b)(o,y.turn())&&Object(k.a)(y.turn(),t)},onDrop:function(t,n,a){w('img[data-piece="'.concat(a,'"]')).removeClass("z-index"),Object(k.d)();var r=y.move({from:t,to:n,promotion:"q"});if(null===r)return"snapback";var i=O.c.collection("games").doc(e);1===o?i.update({fen:y.fen(),whiteSan:r.san,isGameActive:!0}):2===o&&i.update({fen:y.fen(),blackSan:r.san})},onSnapEnd:function(){return x.position(y.fen())},onMouseoutSquare:k.d,onMouseoverSquare:function(e){Object(k.b)(o,y.turn())&&Object(k.c)(y,e)}};x=Object(f.a)("board",r),2===o&&x.orientation("black");var i=w(".chessboard-63f37"),c=w(".square-55d63");return"wooden"===t?(i.addClass("woodenBoard"),c.addClass("transparent")):"classic"===x&&(i.removeClass("woodenBoard"),c.removeClass("transparent")),w(window).resize(x.resize),x}(e,a)).position(y.fen())}(e,a),function(e,t){var n=t.p1_token,a=t.p2_token,o=t.whiteSan,r=t.blackSan,i=t.timeLeft,c=t.moveIndex,s=t.isGameActive,l=Object(g.b)(q.token,{p1_token:n,p2_token:a});I((function(t){return Object(u.a)(Object(u.a)({},t),{},{isGameActive:s,timeLeft:i,id:e,moveIndex:c,p1_token:n,p2_token:a,whiteSan:o,blackSan:r,statusText:Object(k.e)(y.turn(),l,Object(k.b)(l,y.turn()),y.in_draw(),y.in_check(),y.in_checkmate(),y.in_threefold_repetition(),y.insufficient_material(),y.in_stalemate())})}))}(e,a)},["p1_token","p2_token"].forEach((function(t){var n=O.c.collection("games").where(t,"==",e);_=n.onSnapshot((function(e){if(e.size){var t=e.docs.map((function(e){return{data:e.data(),id:e.id}})),n=Object(a.a)(t,1)[0];o(n.id,n.data)}}))})),function(){return _&&_()}}),[]),Object(o.useEffect)((function(){var e;(null===q||void 0===q||null===(e=q.statusText)||void 0===e?void 0:e.split(" ").includes("check"))?R.current.play():P.current.play(),l(q.statusText)}),[q.statusText]),Object(o.useEffect)((function(){var e,t=q.whiteSan,n=q.blackSan;(t||n)&&c({whiteSan:t,blackSan:n,id:Object(j.a)(5),moveIndex:null!==(e=q.moveIndex)&&void 0!==e?e:1});var a=O.c.collection("games").doc(q.id);q.whiteSan&&q.blackSan&&a.update({whiteSan:"",blackSan:"",moveIndex:O.b.firestore.FieldValue.increment(1)})}),[q.whiteSan,q.blackSan]),r.a.createElement(r.a.Fragment,null,(y.game_over()||C)&&r.a.createElement(S.a,{timeLeft:q.timeLeft,turn:y.turn(),user:i}),r.a.createElement(v.a,{timeLeft:q.timeLeft,links:!0,moveSongRef:P,checkSongRef:R,p1_token:q.p1_token,p2_token:q.p2_token,userName:null===i||void 0===i?void 0:i.userName,points:null===i||void 0===i?void 0:i.points,playerNum:Object(g.b)(q.token,q),isGameEnded:y.game_over()||C,changeSite:d,updateLocalStorage:p,token:q.token}))};T.propTypesd={board:d.a.string,piece:d.a.string,token:d.a.string,user:d.a.shape({userName:d.a.string,photo:d.a.string,uid:d.a.string,points:d.a.number}),updateMoves:d.a.func.isRequired,updateStatusText:d.a.func.isRequired,changeSite:d.a.func.isRequired,updateLocalStorage:d.a.func.isRequired};var y=Object(m.f)(T),E=n(90),L=n(72),q=n(31);var I={updateMoves:L.e,updateStatusText:L.f,loginUserWithSocials:q.c,loginUserWithForm:q.b,updateLocalStorage:q.d};t.default=Object(i.b)((function(e){var t=e.boardInfo,n=t.moves,a=t.statusText,o=t.piece,r=t.board;return{moves:n,statusText:a,piece:o,mode:t.mode,boardType:r,user:e.user}}),I)((function(e){var t=e.user,n=e.moves,i=e.statusText,u=e.piece,s=e.boardType,l=e.mode,d=e.history,p=e.updateMoves,b=e.updateStatusText,f=e.loginUserWithSocials,m=e.loginUserWithForm,v=e.updateLocalStorage,S=Object(c.a)(O.a),g=Object(a.a)(S,1)[0];return Object(o.useEffect)((function(){null!==g&&null===t&&f(g),null===g&&null===t&&m()}),[g]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"page__wrapper"},r.a.createElement(y,{changeSite:d.push,user:t,piece:u,boardType:s,updateMoves:p,updateStatusText:b,updateLocalStorage:v,userName:null===t||void 0===t?void 0:t.userName,points:null===t||void 0===t?void 0:t.points,mode:l}),r.a.createElement(E.a,{isOnline:!0,moves:n,statusText:i})))}))},86:function(e,t,n){"use strict";function a(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}n.d(t,"a",(function(){return a}))}}]);
//# sourceMappingURL=11.e1bb6231.chunk.js.map