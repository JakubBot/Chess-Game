(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[10],{76:function(e,t,n){"use strict";function a(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}n.d(t,"a",(function(){return a}))},97:function(e,t,n){"use strict";n.r(t);var a=n(29),o=n(1),r=n.n(o),i=n(21),c=n(66),u=n(5),s=n(76),d=n(20),l=n.n(d),p=n(77),b=n.n(p),f=n(72),m=n(6),v=n(71),O=n(79),S=n(15),g=n(69),j=n(68),k=n(67),h=window.jQuery,w=null,_=null,x=function(e){var t=e.boardType,n=e.piece,i=e.user,c=(e.mode,e.updateMoves),d=e.updateStatusText,l=e.changeSite,p=e.updateLocalStorage,m=Object(s.a)(e,["boardType","piece","user","mode","updateMoves","updateStatusText","changeSite","updateLocalStorage"]),x=Object(o.useState)(new b.a),T=Object(a.a)(x,1)[0],y=Object(o.useState)({token:m.match.params.token}),E=Object(a.a)(y,2),L=E[0],I=E[1],P=Object(o.useRef)(null),q=Object(o.useState)(!1),N=Object(a.a)(q,2),M=N[0],R=N[1];return Object(o.useEffect)((function(){var e,t,n=null,a=Object(g.b)(L.token,L);return L.isGameActive&&1===a&&(n=setInterval((function(){Object(g.c)(L,T)}),1e3)),((null===(e=L.timeLeft)||void 0===e?void 0:e.whiteTime)<=0||(null===(t=L.timeLeft)||void 0===t?void 0:t.blackTime)<=0)&&(clearInterval(n),R(!0)),function(){return clearInterval(n)}}),[L.isGameActive,L.timeLeft]),Object(o.useEffect)((function(){var e,o;return e=L.token,o=function(e,a){!function(e,a){var o=T,r=Object(g.b)(L.token,a);o.load(a.fen||"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"),_?Object(j.b)(r,o.turn())&&_.position(o.fen()):(_=function(e,a){var o=T,r=Object(g.b)(L.token,a),i={pieceTheme:"".concat("/Chess-Game","/img/chesspieces/").concat(n,"/{piece}.png"),draggable:!0,position:"start",onDragStart:function(e,t){return Object(j.c)(T,e),h('img[data-piece="'.concat(t,'"]')).addClass("z-index"),!o.game_over()&&Object(j.b)(r,o.turn())&&Object(j.a)(o.turn(),t)},onDrop:function(t,n,a){h('img[data-piece="'.concat(a,'"]')).removeClass("z-index"),Object(j.d)();var i=T.move({from:t,to:n,promotion:"q"});if(null===i)return"snapback";var c=S.c.collection("games").doc(e);1===r?c.update({fen:o.fen(),whiteSan:i.san,isGameActive:!0}):2===r&&c.update({fen:o.fen(),blackSan:i.san})},onSnapEnd:function(){return P.current.play(),_.position(o.fen())},onMouseoutSquare:j.d,onMouseoverSquare:function(e){Object(j.b)(r,o.turn())&&Object(j.c)(T,e)}};_=Object(f.a)("board",i),2===r&&_.orientation("black");var c=h(".chessboard-63f37"),u=h(".square-55d63");return"wooden"===t?(c.addClass("woodenBoard"),u.addClass("transparent")):"classic"===_&&(c.removeClass("woodenBoard"),u.removeClass("transparent")),h(window).resize(_.resize),_}(e,a)).position(o.fen())}(e,a),function(e,t){var n=t.p1_token,a=t.p2_token,o=t.whiteSan,r=t.blackSan,i=t.timeLeft,c=t.moveIndex,s=t.isGameActive,d=Object(g.b)(L.token,{p1_token:n,p2_token:a});I((function(t){return Object(u.a)(Object(u.a)({},t),{},{isGameActive:s,timeLeft:i,id:e,moveIndex:c,p1_token:n,p2_token:a,whiteSan:o,blackSan:r,statusText:Object(j.e)(T.turn(),d,Object(j.b)(d,T.turn()),T.in_draw(),T.in_check(),T.in_checkmate(),T.in_threefold_repetition(),T.insufficient_material(),T.in_stalemate())})}))}(e,a)},["p1_token","p2_token"].forEach((function(t){var n=S.c.collection("games").where(t,"==",e);w=n.onSnapshot((function(e){if(e.size){var t=e.docs.map((function(e){return{data:e.data(),id:e.id}})),n=Object(a.a)(t,1)[0];o(n.id,n.data)}}))})),function(){return w&&w()}}),[]),Object(o.useEffect)((function(){d(L.statusText)}),[L.statusText]),Object(o.useEffect)((function(){var e,t=L.whiteSan,n=L.blackSan;(t||n)&&c({whiteSan:t,blackSan:n,id:Object(k.a)(5),moveIndex:null!==(e=L.moveIndex)&&void 0!==e?e:1});var a=S.c.collection("games").doc(L.id);L.whiteSan&&L.blackSan&&a.update({whiteSan:"",blackSan:"",moveIndex:S.b.firestore.FieldValue.increment(1)})}),[L.whiteSan,L.blackSan]),r.a.createElement(r.a.Fragment,null,(T.game_over()||M)&&r.a.createElement(O.a,{timeLeft:L.timeLeft,turn:T.turn(),user:i}),r.a.createElement(v.a,{timeLeft:L.timeLeft,links:!0,songRef:P,p1_token:L.p1_token,p2_token:L.p2_token,userName:null===i||void 0===i?void 0:i.userName,points:null===i||void 0===i?void 0:i.points,playerNum:Object(g.b)(L.token,L),isGameEnded:T.game_over()||M,changeSite:l,updateLocalStorage:p,token:L.token}))};x.propTypesd={board:l.a.string,piece:l.a.string,token:l.a.string,user:l.a.shape({userName:l.a.string,photo:l.a.string,uid:l.a.string,points:l.a.number}),updateMoves:l.a.func.isRequired,updateStatusText:l.a.func.isRequired,changeSite:l.a.func.isRequired,updateLocalStorage:l.a.func.isRequired};var T=Object(m.f)(x),y=n(78),E=n(70),L=n(34);var I={updateMoves:E.e,updateStatusText:E.f,loginUserWithSocials:L.c,loginUserWithForm:L.b,updateLocalStorage:L.d};t.default=Object(i.b)((function(e){var t=e.boardInfo,n=t.moves,a=t.statusText,o=t.piece,r=t.board;return{moves:n,statusText:a,piece:o,mode:t.mode,boardType:r,user:e.user}}),I)((function(e){var t=e.user,n=e.moves,i=e.statusText,u=e.piece,s=e.boardType,d=e.mode,l=e.history,p=e.updateMoves,b=e.updateStatusText,f=e.loginUserWithSocials,m=e.loginUserWithForm,v=e.updateLocalStorage,O=Object(c.a)(S.a),g=Object(a.a)(O,1)[0];return Object(o.useEffect)((function(){null!==g&&null===t&&f(g),null===g&&null===t&&m()}),[g]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"page__wrapper"},r.a.createElement(T,{changeSite:l.push,user:t,piece:u,boardType:s,updateMoves:p,updateStatusText:b,updateLocalStorage:v,userName:null===t||void 0===t?void 0:t.userName,points:null===t||void 0===t?void 0:t.points,mode:d}),r.a.createElement(y.a,{isOnline:!0,moves:n,statusText:i})))}))}}]);
//# sourceMappingURL=10.9a618ce4.chunk.js.map