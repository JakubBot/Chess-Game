{"version":3,"sources":["containers/ComputerGamePage/index.js"],"names":["$","window","jQuery","board","game","Chess","ComputerEngine","mapDispatchToProps","updateMoves","boardActions","updateStatusText","loginUserWithSocials","userActions","loginUserWithForm","updateLocalStorage","connect","state","boardInfo","piece","moves","statusText","boardType","user","currentStatusText","history","useAuthState","auth","authUser","useState","whiteSan","blackSan","id","index","gameMove","setGameMove","whiteTime","blackTime","isGameActive","timeLeft","setTimeLeft","isGameEndByTime","setIsGameEndByTime","moveSongRef","useRef","checkSongRef","updateStatus","statusGame","turn","isMyTurn","in_draw","in_check","in_checkmate","in_threefold_repetition","insufficient_material","in_stalemate","split","includes","current","play","useEffect","reset","prevState","game_over","timer","setInterval","clearInterval","generateID","makeEngineMove","computerMove","aiMove","fen","from","Object","keys","toLocaleLowerCase","to","values","move","promotion","san","position","config","pieceTheme","process","draggable","onDragStart","square","makeDots","allowMove","onDrop","source","target","removeDotSquares","innerWidth","setTimeout","onSnapEnd","onMouseoutSquare","onMouseoverSquare","Chessboard","resize","$board","squares","addClass","removeClass","className","EndGameCard","Game","links","playerNum","isGameEnded","changeSite","push","userName","points","ScoreBoard"],"mappings":"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","file":"static/js/12.0bda7a7c.chunk.js","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport Chess from 'chess.js/chess';\nimport Chessboard from '@chrisoakman/chessboardjs/dist/chessboard-1.0.0';\nimport { connect } from 'react-redux';\nimport { useAuthState } from 'react-firebase-hooks/auth';\nimport { Game as ComputerEngine, move as Move, aiMove } from 'js-chess-engine';\nimport ScoreBoard from '../../components/ScoreBoard';\nimport Game from '../../components/common/Game';\nimport { auth } from '../../firebase-config';\nimport { minimaxRoot } from '../../components/utils/gameUtils/computerGameUtils';\nimport {\n  removeDotSquares,\n  allowMove,\n  makeDots,\n  statusText,\n  isMyTurn,\n} from '../../components/utils/gameUtils/commonGameUtils';\nimport { generateID } from '../../components/utils';\nimport * as userActions from '../../redux/actions/userActions';\nimport * as boardActions from '../../redux/actions/boardActions';\nimport EndGameCard from '../../components/EndGameCard';\n\nconst $ = window.jQuery;\nconst INITIAL_FEN = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1';\n\nlet board = null;\nconst game = new Chess();\nconst computerEngine = new ComputerEngine(INITIAL_FEN);\nconst maxDepth = 2;\n\nconst ComputerGamePage = ({\n  history,\n  boardType,\n  user,\n  piece,\n  updateMoves,\n  updateStatusText,\n  moves,\n  currentStatusText,\n  loginUserWithSocials,\n  loginUserWithForm,\n  updateLocalStorage,\n}) => {\n  const [authUser] = useAuthState(auth);\n  const [gameMove, setGameMove] = useState({\n    whiteSan: '',\n    blackSan: '',\n    id: null,\n    index: 0,\n  });\n  const [timeLeft, setTimeLeft] = useState({\n    whiteTime: 300,\n    blackTime: 300,\n    isGameActive: false,\n  });\n  const [isGameEndByTime, setIsGameEndByTime] = useState(false);\n  const moveSongRef = useRef(null);\n  const checkSongRef = useRef(null);\n\n  useEffect(() => {\n    if (authUser !== null && user === null) {\n      loginUserWithSocials(authUser);\n    }\n    if (authUser === null && user === null) {\n      loginUserWithForm();\n    }\n    return () => game.reset();\n  }, [authUser]);\n\n  useEffect(() => {\n    setTimeLeft((prevState) => ({\n      ...prevState,\n      isGameActive: false,\n    }));\n  }, [game.game_over(), isGameEndByTime]);\n\n  useEffect(() => {\n    let timer = null;\n    if (timeLeft.isGameActive) {\n      timer = setInterval(() => {\n        updateTimeLeft();\n      }, 1000);\n    }\n    if (timeLeft.whiteTime <= 0 || timeLeft.blackTime <= 0) {\n      clearInterval(timer);\n      setIsGameEndByTime(true);\n    }\n    return () => clearInterval(timer);\n  }, [timeLeft.isGameActive, timeLeft]);\n\n  function updateTimeLeft() {\n    if (game.turn() === 'w') {\n      setTimeLeft((prevState) => ({\n        ...prevState,\n        whiteTime: prevState.whiteTime - 1,\n      }));\n    } else {\n      setTimeLeft((prevState) => ({\n        ...prevState,\n        blackTime: prevState.blackTime - 1,\n      }));\n    }\n  }\n  useEffect(() => {\n    if (!gameMove) return;\n    const { whiteSan, blackSan, index } = gameMove;\n    if (whiteSan !== '' || blackSan !== '') {\n      updateMoves({\n        whiteSan,\n        blackSan,\n        index,\n        id: generateID(5),\n      });\n    }\n    if (whiteSan !== '' && blackSan !== '') {\n      setGameMove({\n        ...gameMove,\n        whiteSan: '',\n        blackSan: '',\n        id: null,\n      });\n    }\n  }, [gameMove]);\n  useEffect(() => {\n    function makeEngineMove() {\n      setTimeLeft((prevState) => ({\n        ...prevState,\n        blackTime: prevState.blackTime - 1,\n      }));\n      const computerMove = aiMove(game.fen(), 1);\n\n      const from = Object.keys(computerMove)[0].toLocaleLowerCase();\n      const to = Object.values(computerMove)[0].toLocaleLowerCase();\n\n      const move = game.move({\n        from,\n        to,\n        promotion: 'q',\n      });\n\n      setGameMove((prevState) => ({\n        ...prevState,\n        blackSan: move?.san,\n      }));\n\n      board.position(game.fen());\n      updateStatus();\n    }\n\n    function onDragStart(square, piece) {\n      makeDots(game, square);\n\n      return (\n        !game.game_over() &&\n        game.turn() === 'w' &&\n        allowMove(game.turn(), piece)\n      );\n    }\n\n    function onDrop(source, target) {\n      removeDotSquares();\n      const move = game.move({\n        from: source,\n        to: target,\n        promotion: 'q',\n      });\n      if (move === null) {\n        return 'snapback';\n      }\n\n      if (window.innerWidth < 520) {\n        window.setTimeout(makeEngineMove, 2400);\n      } else {\n        window.setTimeout(makeEngineMove, 3300);\n      }\n\n      setGameMove((prevState) => ({\n        ...prevState,\n        whiteSan: move?.san,\n        index: prevState.index + 1,\n      }));\n      setTimeLeft((prevState) => ({\n        ...prevState,\n        isGameActive: true,\n      }));\n    }\n\n    function onSnapEnd() {\n      board.position(game.fen());\n      updateStatus();\n    }\n\n    function onMouseoverSquare(square) {\n      makeDots(game, square);\n    }\n\n    const config = {\n      pieceTheme: `${process.env.PUBLIC_URL}/img/chesspieces/${piece}/{piece}.png`,\n      draggable: true,\n      position: 'start',\n      onDragStart,\n      onDrop,\n      onSnapEnd,\n      onMouseoutSquare: removeDotSquares,\n      onMouseoverSquare,\n    };\n\n    board = Chessboard('board', config);\n\n    $(window).resize(board.resize);\n\n    const $board = $('.chessboard-63f37');\n    const squares = $('.square-55d63');\n\n    if (boardType === 'wooden') {\n      $board.addClass('woodenBoard');\n      squares.addClass('transparent');\n    } else if (board === 'classic') {\n      $board.removeClass('woodenBoard');\n      squares.removeClass('transparent');\n    }\n    updateStatus();\n  }, []);\n\n  function updateStatus() {\n    const statusGame = statusText(\n      game.turn(),\n      1,\n      isMyTurn(1, game.turn()),\n      game.in_draw(),\n      game.in_check(),\n      game.in_checkmate(),\n      game.in_threefold_repetition(),\n      game.insufficient_material(),\n      game.in_stalemate()\n    );\n    if (statusGame.split(' ').includes('check')) {\n      checkSongRef.current.play();\n    } else {\n      moveSongRef.current.play();\n    }\n    updateStatusText(statusGame);\n  }\n\n  return (\n    <>\n      <div className=\"page__wrapper\">\n        {(game.game_over() || isGameEndByTime) && (\n          <EndGameCard timeLeft={timeLeft} turn={game.turn()} user={user} />\n        )}\n        <Game\n          timeLeft={timeLeft}\n          moveSongRef={moveSongRef}\n          checkSongRef={checkSongRef}\n          links={false}\n          playerNum={1}\n          isGameEnded={game.game_over() || isGameEndByTime}\n          changeSite={history.push}\n          updateLocalStorage={updateLocalStorage}\n          userName={user?.userName}\n          points={user?.points}\n          turn={game.turn()}\n        />\n        <ScoreBoard moves={moves} statusText={currentStatusText} />\n      </div>\n    </>\n  );\n};\n\nfunction mapStateToProps(state) {\n  const { piece, board, moves, statusText } = state.boardInfo;\n  const { user } = state;\n  return {\n    piece,\n    boardType: board,\n    user,\n    moves,\n    currentStatusText: statusText,\n  };\n}\n\nconst mapDispatchToProps = {\n  updateMoves: boardActions.updateMoves,\n  updateStatusText: boardActions.updateStatusText,\n  loginUserWithSocials: userActions.loginUserWithSocials,\n  loginUserWithForm: userActions.loginUserWithForm,\n  updateLocalStorage: userActions.updateLocalStorage,\n};\n\nComputerGamePage.propTypes = {\n  history: PropTypes.shape({\n    push: PropTypes.func.isRequired,\n  }),\n  boardType: PropTypes.string.isRequired,\n  piece: PropTypes.string.isRequired,\n  user: PropTypes.shape({\n    userName: PropTypes.string,\n    photo: PropTypes.string,\n    uid: PropTypes.string,\n    points: PropTypes.number,\n  }),\n  moves: PropTypes.arrayOf(\n    PropTypes.shape({\n      whiteSan: PropTypes.string,\n      blackSan: PropTypes.string,\n      index: PropTypes.number,\n      id: PropTypes.string,\n    })\n  ).isRequired,\n  currentStatusText: PropTypes.string.isRequired,\n  updateMoves: PropTypes.func.isRequired,\n  updateStatusText: PropTypes.func.isRequired,\n  loginUserWithSocials: PropTypes.func.isRequired,\n  loginUserWithForm: PropTypes.func.isRequired,\n  updateLocalStorage: PropTypes.func.isRequired,\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ComputerGamePage);\n"],"sourceRoot":""}